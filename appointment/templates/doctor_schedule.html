{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">ğŸ“… Lá»‹ch khÃ¡m cá»§a báº¡n</h2>

<h4>Sáº¯p tá»›i</h4>
{% for a in upcoming %}
  <div class="card mb-3 p-3 shadow-sm">
    <h5>{{ a.date_time|date:"H:i - d/m/Y" }}</h5>
    <p><strong>Tráº¡ng thÃ¡i:</strong> {{ a.get_status_display }}</p>
    <p><strong>LÃ½ do khÃ¡m:</strong> {{ a.reason }}</p>
    <p><strong>Ghi chÃº:</strong> {{ a.notes|default:"(KhÃ´ng cÃ³)" }}</p>
    <hr>
    <h6>ğŸ‘¤ Bá»‡nh nhÃ¢n</h6>
    <p>Há» tÃªn: {{ a.patient_profile.full_name }}</p>
    <p>SÄT: {{ a.patient_profile.phone_number }}</p>
    <p>Giá»›i tÃ­nh: {{ a.patient_profile.gender }}</p>
    <p>NgÃ y sinh: {{ a.patient_profile.date_of_birth }}</p>

    <form method="post" action="{% url 'update-appointment' a.id %}">
      {% csrf_token %}
      <label for="status">Cáº­p nháº­t tráº¡ng thÃ¡i:</label>
      <select name="status" class="form-select mb-2">
        {% for key, val in a.STATUS_CHOICES %}
          <option value="{{ key }}" {% if key == a.status %}selected{% endif %}>{{ val }}</option>
        {% endfor %}
      </select>

      <label for="notes">Ghi chÃº:</label>
      <textarea name="notes" class="form-control">{{ a.notes }}</textarea>
      <br>
      <button type="submit" class="btn btn-primary">ğŸ’¾ LÆ°u thay Ä‘á»•i</button>
    </form>
  </div>
{% empty %}
  <div class="alert alert-info">KhÃ´ng cÃ³ lá»‹ch khÃ¡m nÃ o.</div>
{% endfor %}

<h4 class="mt-4">Lá»‹ch sá»­</h4>
{% for a in history %}
  <div class="card mb-3 p-3 shadow-sm">
    <h5>{{ a.date_time|date:"H:i - d/m/Y" }}</h5>
    <p><strong>Tráº¡ng thÃ¡i:</strong> {{ a.get_status_display }}</p>
    <p><strong>LÃ½ do khÃ¡m:</strong> {{ a.reason }}</p>
    <p><strong>Ghi chÃº:</strong> {{ a.notes|default:"(KhÃ´ng cÃ³)" }}</p>
    <hr>
    <h6>ğŸ‘¤ Bá»‡nh nhÃ¢n</h6>
    <p>Há» tÃªn: {{ a.patient_profile.full_name }}</p>
    <p>SÄT: {{ a.patient_profile.phone_number }}</p>
    <p>Giá»›i tÃ­nh: {{ a.patient_profile.gender }}</p>
    <p>NgÃ y sinh: {{ a.patient_profile.date_of_birth }}</p>

    <form method="post" action="{% url 'update-appointment' a.id %}">
      {% csrf_token %}
      <label for="status">Cáº­p nháº­t tráº¡ng thÃ¡i:</label>
      <select name="status" class="form-select mb-2">
        {% for key, val in a.STATUS_CHOICES %}
          <option value="{{ key }}" {% if key == a.status %}selected{% endif %}>{{ val }}</option>
        {% endfor %}
      </select>

      <label for="notes">Ghi chÃº:</label>
      <textarea name="notes" class="form-control">{{ a.notes }}</textarea>
      <br>
      <button type="submit" class="btn btn-primary">ğŸ’¾ LÆ°u thay Ä‘á»•i</button>
    </form>
  </div>
{% empty %}
  <div class="alert alert-info">KhÃ´ng cÃ³ lá»‹ch sá»­.</div>
{% endfor %}
{% endblock %}
